<!--
<div class="flex h-screen bg-gray-100">
    &lt;!&ndash; Sidebar &ndash;&gt;
    <div class="w-80 bg-gray-800 text-white overflow-y-auto">
        <div class="p-4 text-xl font-bold bg-gray-900">Connected Users</div>

        &lt;!&ndash; Loading Indicator &ndash;&gt;
        <div *ngIf="isLoadingConnectedUsers" class="p-4 text-center">
            <svg class="animate-spin h-5 w-5 text-gray-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
            </svg>
        </div>

        &lt;!&ndash; Connected Users List &ndash;&gt;
        <div class="divide-y divide-gray-700" *ngIf="!isLoadingConnectedUsers">
            <ng-container *ngFor="let user of connectedUsers">
                <a (click)="selectPartner(user)" class="block p-4 hover:bg-gray-700 transition duration-200 cursor-pointer relative">
                    <div class="flex items-center">
                        <div class="rounded-full h-10 w-10 overflow-hidden bg-gray-600">
                            <img *ngIf="user.imageUrl; else defaultImage" [src]="user.imageUrl" [alt]="user.name" class="object-cover w-full h-full">
                            <ng-template #defaultImage>
                                <img src="assets/icons/default-profile.png" alt="Default Profile" class="object-cover w-full h-full">
                            </ng-template>
                        </div>
                        <div class="ml-3">
                            <p class="font-semibold">{{ user.name }}</p>
                            <p class="text-sm text-gray-400">{{ user.service || 'Service not specified' }}</p>
                        </div>
                    </div>
                    &lt;!&ndash; Badge Indicator &ndash;&gt;
                    <span *ngIf="unreadMessages[user.id] > 0" matBadge="{{ unreadMessages[user.id] }}" matBadgeOverlap="false" class="absolute top-4 right-4"></span>
                </a>
            </ng-container>
        </div>
    </div>

    &lt;!&ndash; Chat Area &ndash;&gt;
    <div class="flex-1 flex flex-col">
        &lt;!&ndash; Chat Header &ndash;&gt;
        <div class="bg-gray-700 p-4 flex items-center justify-between">
            <div class="flex items-center">
                <div class="rounded-full h-10 w-10 overflow-hidden bg-gray-600">
                    <img *ngIf="selectedUser?.imageUrl; else defaultChatImage" [src]="'data:image/jpeg;base64,' + selectedUser?.imageUrl" [alt]="selectedUser?.name" class="object-cover w-full h-full">
                    <ng-template #defaultChatImage>
                        <img src="assets/default-profile.png" alt="Default Profile" class="object-cover w-full h-full">
                    </ng-template>
                </div>
                <div class="ml-3">
                    <p class="font-semibold">{{ selectedUser?.name || 'Select a user to chat' }}</p>
                    <p class="text-sm text-gray-400">{{ selectedUser?.status || 'Offline' }}</p>
                </div>
            </div>
            <div class="flex space-x-4">
                <button class="text-white hover:text-gray-300" (click)="videoCallWithUser()" [disabled]="!selectedUser">
                    &lt;!&ndash; Video Call Icon &ndash;&gt;
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.447v7.106a1 1 0 01-1.447.894L15 14m0 0l-4.553 2.276A1 1 0 019 14.553V9.447a1 1 0 011.447-.894L15 10z" />
                    </svg>
                </button>
            </div>
        </div>

        &lt;!&ndash; Messages &ndash;&gt;
        <div class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-200">
            <ng-container *ngFor="let message of messageList">
                <div [ngClass]="{'flex justify-end': message.message_side === 'sender', 'flex justify-start': message.message_side === 'receiver'}">
                    <div [ngClass]="{'bg-blue-600 text-white': message.message_side === 'sender', 'bg-gray-300 text-black': message.message_side === 'receiver'}" class="max-w-xs md:max-w-md rounded-lg p-3 shadow">
                        <p class="text-sm">{{ message.message }}</p>
                        <p class="text-xs text-gray-600 mt-1 text-right">{{ message.timeStamp | date:'shortTime' }}</p>
                    </div>
                </div>
            </ng-container>
        </div>

        &lt;!&ndash; Message Input &ndash;&gt;
        <div class="bg-gray-700 p-4">
            <div class="flex items-center bg-white rounded-full shadow">
                <input type="text" [(ngModel)]="messageInput" (keydown.enter)="sendMessage()" class="flex-1 bg-transparent text-gray-800 placeholder-gray-500 px-4 py-2 focus:outline-none" placeholder="Type a message...">
                <button (click)="sendMessage()" class="text-blue-500 hover:text-blue-700 px-4" [disabled]="!messageInput.trim()">
                    &lt;!&ndash; Send Icon &ndash;&gt;
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transform rotate-45" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>
-->

<div class="flex h-screen bg-gray-50">
    <!-- Sidebar -->
    <div class="w-80 bg-gray-800 text-white overflow-y-auto">
        <div class="p-4 text-2xl font-bold bg-gray-900">Connected Users</div>

        <!-- Loading Indicator -->
        <div *ngIf="isLoadingConnectedUsers" class="p-4 text-center">
            <svg class="animate-spin h-6 w-6 text-gray-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
            </svg>
        </div>

        <!-- Connected Users List -->
        <div class="divide-y divide-gray-700" *ngIf="!isLoadingConnectedUsers">
            <ng-container *ngFor="let user of connectedUsers">
                <a (click)="selectPartner(user)" class="block p-4 hover:bg-gray-700 transition duration-200 cursor-pointer relative">
                    <div class="flex items-center">
                        <div class="rounded-full h-12 w-12 overflow-hidden bg-gray-600">
                            <img *ngIf="user.imageUrl; else defaultImage" [src]="user.imageUrl" [alt]="user.name" class="object-cover w-full h-full">
                            <ng-template #defaultImage>
                                <img src="assets/icons/default-profile.png" alt="Default Profile" class="object-cover w-full h-full">
                            </ng-template>
                        </div>
                        <div class="ml-4">
                            <p class="font-semibold text-lg">{{ user.name }}</p>
<!--                            <p class="text-sm text-gray-400">{{ user.service || 'Service not specified' }}</p>-->
                        </div>
                    </div>
                    <!-- Badge Indicator -->
                    <span *ngIf="unreadMessages[user.id] > 0" matBadge="{{ unreadMessages[user.id] }}" matBadgeOverlap="false" class="absolute top-4 right-4"></span>
                </a>
            </ng-container>
        </div>
    </div>

    <!-- Chat Area -->
    <div class="flex-1 flex flex-col">
        <!-- Chat Header -->
        <div class="bg-indigo-600 p-4 flex items-center justify-between">
            <div class="flex items-center">
                <div class="rounded-full h-12 w-12 overflow-hidden bg-gray-600">
                    <img *ngIf="selectedUser?.imageUrl; else defaultChatImage" [src]="'data:image/jpeg;base64,' + selectedUser?.imageUrl" [alt]="selectedUser?.name" class="object-cover w-full h-full">
                    <ng-template #defaultChatImage>
                        <img src="assets/icons/default-profile.png" alt="Default Profile" class="object-cover w-full h-full">
                    </ng-template>
                </div>
                <div class="ml-4">
                    <p class="font-semibold text-lg">{{ selectedUser?.name || 'Select a user to chat' }}</p>
                    <p class="text-sm text-gray-300">{{ selectedUser?.status || 'Online' }}</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <!-- Notification Icon -->
                <button class="relative text-white hover:text-gray-300" (click)="toggleNotifications()">
                    <!-- Notification Bell Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                    </svg>
                    <!-- Badge -->
                    <span *ngIf="totalUnreadMessages > 0" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full">{{ totalUnreadMessages }}</span>
                </button>

                <!-- Video Call Icon -->
                <button class="text-white hover:text-gray-300" (click)="videoCallWithUser()" [disabled]="!selectedUser">
                    <!-- Video Call Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.447v7.106a1 1 0 01-1.447.894L15 14m0 0l-4.553 2.276A1 1 0 019 14.553V9.447a1 1 0 011.447-.894L15 10z" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Notification Dropdown -->
        <div *ngIf="showNotifications" class="absolute top-20 right-20 bg-white shadow-lg rounded-lg w-80 z-50">
            <div class="p-4 border-b">
                <h3 class="text-lg font-semibold">Notifications</h3>
            </div>
            <div class="p-4 max-h-60 overflow-y-auto">
                <div *ngFor="let notification of notifications" class="mb-2">
                    <p class="text-sm text-gray-700">{{ notification.message }}</p>
                    <p class="text-xs text-gray-500">{{ notification.time | date:'short' }}</p>
                </div>
                <div *ngIf="notifications.length === 0" class="text-center text-gray-500">
                    No new notifications.
                </div>
            </div>
            <div class="p-4 border-t text-right">
                <button class="text-indigo-600 hover:underline" (click)="markNotificationsAsRead()">Mark all as read</button>
            </div>
        </div>

        <!-- Messages -->
        <div class="flex-1 overflow-y-auto p-6 space-y-4 bg-gray-100">
            <ng-container *ngFor="let message of messageList">
                <div [ngClass]="{'flex justify-end': message.message_side === 'sender', 'flex justify-start': message.message_side === 'receiver'}">
                    <div [ngClass]="{'bg-indigo-500 text-white': message.message_side === 'sender', 'bg-gray-300 text-gray-800': message.message_side === 'receiver'}" class="max-w-md md:max-w-lg rounded-lg p-4 shadow">
                        <p class="text-sm">{{ message.message }}</p>
                        <p class="text-xs text-gray-500 mt-2 text-right">{{ message.timeStamp | date:'shortTime' }}</p>
                    </div>
                </div>
            </ng-container>
        </div>

        <!-- Message Input -->
        <div class="bg-indigo-600 p-4">
            <div class="flex items-center bg-white rounded-full shadow">
                <input type="text" [(ngModel)]="messageInput" (keydown.enter)="sendMessage()" class="flex-1 bg-transparent text-gray-800 placeholder-gray-500 px-4 py-2 focus:outline-none" placeholder="Type a message...">
                <button (click)="sendMessage()" class="text-indigo-600 hover:text-indigo-800 px-4" [disabled]="!messageInput.trim()">
                    <!-- Send Icon -->
                    <span nz-icon nzType="send" nzTheme="outline"></span>
                </button>
            </div>
        </div>
    </div>
</div>

